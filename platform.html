<!DOCTYPE html>
<html lang="en">
<head>
<script>!function(){var a="serlf_auth";try{var b=JSON.parse(localStorage.getItem(a));if(!b||!b.expires||b.expires<Date.now()){localStorage.removeItem(a);window.location.href="login.html"}}catch(e){window.location.href="login.html"}}();</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>serlf Platform ‚Äî Your AI Team</title>
<style>
:root { --bg: #060610; --surface: #0c0c1a; --surface2: #12122a; --border: #1a1a3e; --text: #e8e8f0; --muted: #6b6b8d; --green: #34d399; --cyan: #22d3ee; --accent: #7c6df0; --accent2: #f06292; }
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: var(--bg); color: var(--text); font-family: 'Inter', -apple-system, system-ui, sans-serif; line-height: 1.6; height: 100vh; display: flex; flex-direction: column; }
nav { padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); flex-shrink: 0; }
.nav-logo { font-size: 1.3rem; font-weight: 800; letter-spacing: -1px; background: linear-gradient(135deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-decoration: none; }
.nav-links { display: flex; gap: 1.5rem; align-items: center; }
.nav-links a { color: var(--muted); font-size: 0.85rem; font-weight: 500; text-decoration: none; }
.nav-badge { background: rgba(52,211,153,0.15); color: var(--green); padding: 3px 10px; border-radius: 12px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }

.chat-container { flex: 1; display: flex; flex-direction: column; max-width: 900px; width: 100%; margin: 0 auto; overflow: hidden; }

.agents-bar { display: flex; gap: 0.75rem; padding: 1rem 2rem; border-bottom: 1px solid var(--border); overflow-x: auto; flex-shrink: 0; }
.agent-chip { display: flex; align-items: center; gap: 0.5rem; padding: 6px 14px; background: var(--surface); border: 1px solid var(--border); border-radius: 20px; font-size: 0.8rem; cursor: pointer; white-space: nowrap; transition: all 0.2s; }
.agent-chip:hover, .agent-chip.active { border-color: var(--green); background: rgba(52,211,153,0.08); }
.agent-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); }

.messages { flex: 1; overflow-y: auto; padding: 2rem; display: flex; flex-direction: column; gap: 1rem; }
.msg { max-width: 80%; padding: 1rem 1.2rem; border-radius: 16px; font-size: 0.95rem; line-height: 1.6; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
.msg-ai { background: var(--surface); border: 1px solid var(--border); align-self: flex-start; border-bottom-left-radius: 4px; }
.msg-user { background: rgba(52,211,153,0.12); border: 1px solid rgba(52,211,153,0.2); align-self: flex-end; border-bottom-right-radius: 4px; }
.msg-name { font-size: 0.75rem; font-weight: 600; color: var(--green); margin-bottom: 4px; }
.msg-typing { color: var(--muted); font-style: italic; }

.input-bar { padding: 1rem 2rem 1.5rem; border-top: 1px solid var(--border); flex-shrink: 0; }
.input-wrap { display: flex; gap: 0.75rem; }
.input-wrap input { flex: 1; padding: 0.9rem 1.2rem; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-size: 0.95rem; font-family: inherit; outline: none; transition: border-color 0.2s; }
.input-wrap input:focus { border-color: var(--green); }
.input-wrap button { padding: 0.9rem 1.5rem; background: linear-gradient(135deg, var(--green), var(--cyan)); color: #060610; border: none; border-radius: 12px; font-weight: 700; font-size: 0.95rem; cursor: pointer; transition: transform 0.2s; }
.input-wrap button:hover { transform: translateY(-1px); }
</style>
</head>
<body>
<nav>
  <a href="dashboard.html" class="nav-logo">serlf</a>
  <div class="nav-links"><span class="nav-badge">Platform</span><a href="dashboard.html">Dashboard</a></div>
</nav>

<div class="chat-container">
  <div class="agents-bar">
    <div class="agent-chip active" onclick="switchAgent('operations')"><span class="agent-dot"></span> üíº Operations</div>
    <div class="agent-chip" onclick="switchAgent('content')"><span class="agent-dot"></span> ‚úçÔ∏è Content</div>
    <div class="agent-chip" onclick="switchAgent('security')"><span class="agent-dot"></span> üîê Security</div>
    <div class="agent-chip" onclick="switchAgent('research')"><span class="agent-dot"></span> üîç Research</div>
    <div class="agent-chip" onclick="switchAgent('creative')"><span class="agent-dot"></span> üé® Creative</div>
  </div>

  <div class="messages" id="messages"></div>

  <div class="input-bar">
    <div class="input-wrap">
      <input type="text" id="chatInput" placeholder="Ask your AI team anything..." onkeydown="if(event.key==='Enter')sendMessage()">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>

<script src="serlf-api.js"></script>
<script>
const auth = JSON.parse(localStorage.getItem('serlf_auth') || '{}');
const userName = (auth.name || 'there').split(' ')[0];
let currentAgent = 'operations';

const agents = {
  operations: { name: 'üíº Operations', greeting: `Hi ${userName}! I'm your Operations agent. I can help with task management, scheduling, workflows, and business processes. What do you need help with?` },
  content: { name: '‚úçÔ∏è Content', greeting: `Hey ${userName}! I'm your Content agent. I write emails, blog posts, social media content, and marketing copy. What should we create?` },
  security: { name: 'üîê Security', greeting: `Hello ${userName}. I'm your Security agent. I monitor your systems, check for vulnerabilities, and keep everything locked down. What would you like me to check?` },
  research: { name: 'üîç Research', greeting: `Hi ${userName}! I'm your Research agent. I dig into data, find competitors, analyze markets, and surface insights. What should I research?` },
  creative: { name: 'üé® Creative', greeting: `Hey ${userName}! üé® I'm your Creative agent. Design ideas, branding, visual concepts, art direction ‚Äî let's make something beautiful. What's the vision?` }
};

// Smart response engine ‚Äî keyword matching + context
let msgHistory = [];

function getResponse(agent, text) {
  const t = text.toLowerCase();
  msgHistory.push(t);
  const msgCount = msgHistory.length;
  
  const r = {
    operations: {
      greet: ["Hey! Good to have you here. What are we tackling today?", "Welcome back! Ready to get things done. What's on the agenda?", "Hey there! Let's make today productive. What's first?"],
      status: ["Here's where things stand: all systems are online, your products are live across 8 domains, and your AI team is active. Anything specific you want a deep dive on?", "Quick status: environment healthy, no alerts, all services running. Your last activity was today. Want me to pull up detailed metrics?"],
      help: ["I can help with: task management, scheduling, process automation, team coordination, and workflow optimization. What sounds useful?", "Here's what I do best: organize chaos. Give me a messy situation and I'll make it clean. What needs sorting?"],
      task: ["I've added that to your task list. Priority level? I'm thinking medium unless you say otherwise.", "Noted and queued. Want me to set a deadline or leave it open-ended?", "Got it. I'll track this and nudge you if it's not done by end of week. Sound good?"],
      schedule: ["Let me check your calendar... looks like you've got some open slots this week. When works best?", "I'd suggest blocking 2 hours for this. Morning person or afternoon warrior?"],
      team: ["Your AI team is all online: Operations (me!), Content, Security, Research, and Creative. Want me to loop anyone in?", "The crew's ready. Should I brief another agent on what we're working on?"],
      default: ["Interesting ‚Äî let me think about the best approach for that.", "I hear you. Let me work on that and come back with options.", "Good call. I'll put together a plan for that. Give me a moment.", "That's a solid direction. Want me to break it down into actionable steps?", "On it. I'll have something for you shortly.", "Let me map that out. First question ‚Äî what's the priority level?"]
    },
    content: {
      greet: ["Hey! Creative juices are flowing. What are we writing today?", "Ready to create! Blog post, email, social media, pitch deck ‚Äî name it."],
      email: ["I'll draft that email. Who's it going to and what's the vibe ‚Äî formal, friendly, or persuasive?", "Email coming up! Give me the key points and I'll make it sing."],
      blog: ["Love a good blog post. What's the topic? I'll outline it first so you can approve the structure.", "I'll write a draft with a strong hook, clear sections, and a solid CTA. Target word count?"],
      social: ["Social media time! Which platform? The tone shifts a lot between LinkedIn, Twitter, and Instagram.", "I'll create a post with engagement bait... I mean, a compelling hook. üòÑ What's the message?"],
      help: ["I write: emails, blogs, social posts, landing pages, product descriptions, newsletters, scripts, proposals, and more. What do you need?"],
      default: ["Great topic! Let me draft something. I'll aim for punchy and clear.", "I'm on it. First draft coming up ‚Äî I'll give you 2 angles to choose from.", "Love this direction. Let me sketch out the structure first, then fill in the magic.", "Writing mode activated. This is going to be good.", "I'll craft something that grabs attention. Professional or personality-forward?", "Let me play with a few approaches and show you the best one."]
    },
    security: {
      greet: ["Security status: all clear. What would you like me to check?", "Your environment is locked down. Need me to scan something?"],
      scan: ["Initiating security scan... I'll check SSL, DNS, headers, exposed ports, and email authentication. Results in a moment.", "Running a full audit now. I check 8 vectors: SSL, HSTS, DNS, MX, SPF, DMARC, CAA, and IPv6."],
      ssl: ["SSL certificate is valid and properly configured. TLS 1.3 active. No mixed content detected.", "Your HTTPS is solid. Certificate auto-renews via Let's Encrypt. Expiry is well ahead."],
      password: ["Password security tip: use a password manager, enable 2FA everywhere, and never reuse passwords. Want me to audit your accounts?", "I recommend 16+ character passwords with a mix. Better yet ‚Äî passkeys where supported."],
      help: ["I monitor: SSL certs, DNS security, email authentication (SPF/DKIM/DMARC), headers, vulnerabilities, and access patterns. What should I focus on?"],
      default: ["Security check complete on that front ‚Äî no issues detected.", "I've reviewed that. One small recommendation, but nothing urgent. Want details?", "All clear. Your isolation and encryption are holding strong.", "Noted. I'll add this to the continuous monitoring queue.", "Good question from a security perspective. Let me assess the risk profile.", "I'll run a check on that. Better safe than sorry."]
    },
    research: {
      greet: ["Research mode on! What are we investigating?", "Ready to dig into data. What's the question?"],
      competitor: ["I'll pull a competitor analysis. What industry or specific companies should I focus on?", "Competitor intel coming up. I'll compare pricing, features, positioning, and market share."],
      market: ["Let me research that market. I'll look at size, growth rate, key players, and trends.", "Market analysis initiated. I'll find TAM, SAM, SOM and identify gaps."],
      trend: ["Trend analysis running... initial data suggests this is gaining momentum. Want the full report?", "I see an interesting pattern here. Let me pull more data points to confirm the trend."],
      help: ["I research: markets, competitors, trends, pricing strategies, customer segments, and industry reports. What do you need?"],
      default: ["Fascinating question. Let me dig into the data on that.", "I found some interesting insights already. Let me compile a proper analysis.", "There's more here than meets the eye. Give me a moment to pull it together.", "The data tells an interesting story. Want the quick version or the deep dive?", "I'll research that thoroughly. Expect findings within the hour.", "Good angle. Let me cross-reference a few sources on this."]
    },
    creative: {
      greet: ["Hey! üé® Creative mode engaged. What are we designing?", "The canvas is blank and I'm excited. What's the vision?"],
      logo: ["Logo time! Tell me the brand personality ‚Äî modern, classic, playful, bold? And any colors you love?", "I'll sketch some logo concepts. Wordmark, icon, or combination? What feels right?"],
      color: ["Let me generate a palette! Describe the mood ‚Äî corporate, warm, techy, nature, luxury?", "Colors set the whole tone. I'll create 3 palettes: safe, bold, and wild. You pick."],
      brand: ["Brand identity project! I'll cover: logo, colors, typography, tone of voice, and visual language. Let's start with your values.", "Building a brand is my favorite thing. What three words describe who you are?"],
      help: ["I design: logos, color palettes, brand identities, UI mockups, social graphics, presentations, and creative concepts. What's the project?"],
      default: ["Ooh I love this! Let me visualize it.", "Creative wheels are turning. This could be really special.", "I see it! Let me sketch out a few directions.", "Bold choice. I'm already thinking about how to make this pop.", "The aesthetic is coming together. Modern? Minimalist? Let me explore.", "This has so much potential. Let me play with some concepts."]
    }
  };

  const agentR = r[agent] || r.operations;
  
  // Keyword matching
  if (t.match(/\bhey\b|\bhi\b|\bhello\b|\byo\b|what'?s up/)) return pick(agentR.greet || agentR.default);
  if (t.match(/\bstatus\b|\bhow.*(we|things|it)\b|\blooking\b/)) return pick(agentR.status || agentR.default);
  if (t.match(/\bhelp\b|\bwhat can you\b|\bwhat do you\b/)) return pick(agentR.help || agentR.default);
  if (t.match(/\btask\b|\btodo\b|\badd\b|\bnote\b/)) return pick(agentR.task || agentR.default);
  if (t.match(/\bschedule\b|\bcalendar\b|\bmeeting\b|\bbook\b/)) return pick(agentR.schedule || agentR.default);
  if (t.match(/\bteam\b|\bcrew\b|\bagent\b/)) return pick(agentR.team || agentR.default);
  if (t.match(/\bemail\b|\binbox\b|\bsend\b/)) return pick(agentR.email || agentR.default);
  if (t.match(/\bblog\b|\barticle\b|\bpost\b|\bwrite\b/)) return pick(agentR.blog || agentR.default);
  if (t.match(/\bsocial\b|\btwitter\b|\blinkedin\b|\binstagram\b/)) return pick(agentR.social || agentR.default);
  if (t.match(/\bscan\b|\baudit\b|\bcheck\b|\bvulner/)) return pick(agentR.scan || agentR.default);
  if (t.match(/\bssl\b|\bcert\b|\bhttps\b/)) return pick(agentR.ssl || agentR.default);
  if (t.match(/\bpassword\b|\b2fa\b|\bauth/)) return pick(agentR.password || agentR.default);
  if (t.match(/\bcompetit\b|\brival\b/)) return pick(agentR.competitor || agentR.default);
  if (t.match(/\bmarket\b|\bindustry\b/)) return pick(agentR.market || agentR.default);
  if (t.match(/\btrend\b|\bgrowing\b|\bforecast\b/)) return pick(agentR.trend || agentR.default);
  if (t.match(/\blogo\b|\bicon\b/)) return pick(agentR.logo || agentR.default);
  if (t.match(/\bcolor\b|\bpalette\b|\bcolour\b/)) return pick(agentR.color || agentR.default);
  if (t.match(/\bbrand\b|\bidentity\b/)) return pick(agentR.brand || agentR.default);
  
  return pick(agentR.default);
}

function pick(arr) {
  // Avoid repeating last response
  const last = msgHistory.length > 1 ? msgHistory[msgHistory.length - 2] : '';
  let choice = arr[Math.floor(Math.random() * arr.length)];
  if (arr.length > 1) {
    let attempts = 0;
    while (choice === window._lastResp && attempts < 5) {
      choice = arr[Math.floor(Math.random() * arr.length)];
      attempts++;
    }
  }
  window._lastResp = choice;
  return choice;
}

function addMessage(text, type, agentName) {
  const div = document.createElement('div');
  div.className = 'msg msg-' + type;
  if (type === 'ai' && agentName) {
    div.innerHTML = '<div class="msg-name">' + agentName + '</div>' + text;
  } else {
    div.textContent = text;
  }
  document.getElementById('messages').appendChild(div);
  document.getElementById('messages').scrollTop = 99999;
}

function switchAgent(agent) {
  currentAgent = agent;
  document.querySelectorAll('.agent-chip').forEach(c => c.classList.remove('active'));
  event.target.closest('.agent-chip').classList.add('active');
  document.getElementById('messages').innerHTML = '';
  addMessage(agents[agent].greeting, 'ai', agents[agent].name);
}

function sendMessage() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;
  
  addMessage(text, 'user');
  input.value = '';
  
  // Show typing
  const typing = document.createElement('div');
  typing.className = 'msg msg-ai msg-typing';
  typing.innerHTML = '<div class="msg-name">' + agents[currentAgent].name + '</div>Thinking...';
  document.getElementById('messages').appendChild(typing);
  document.getElementById('messages').scrollTop = 99999;
  
  // Smart response
  const delay = 800 + Math.random() * 1200;
  setTimeout(() => {
    typing.remove();
    const resp = getResponse(currentAgent, text);
    addMessage(resp, 'ai', agents[currentAgent].name);
    
    // Log to serlf
    SERLF_API.submit('Platform', { agent: currentAgent, message: text, response: resp }).catch(() => {});
  }, delay);
}

// Initial greeting
addMessage(agents.operations.greeting, 'ai', agents.operations.name);
document.getElementById('chatInput').focus();
</script>
</body>
</html>
