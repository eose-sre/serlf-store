<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admiral Fleet Control â€” Portal</title>
<style>
:root{--bg:#060610;--surface:#0c0c1a;--surface2:#12122a;--border:#1a1a3e;--text:#e8e8f0;--muted:#6b6b8d;--green:#34d399;--cyan:#22d3ee;--accent:#7c6df0;--red:#ef4444;--yellow:#f59e0b;--orange:#f97316;--pink:#ec4899;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'Inter',-apple-system,system-ui,sans-serif;line-height:1.6;min-height:100vh;}
a{color:var(--cyan);text-decoration:none;}
a:hover{text-decoration:underline;}

/* Auth Gate */
.auth-gate{display:flex;align-items:center;justify-content:center;min-height:100vh;flex-direction:column;gap:1.5rem;}
.auth-gate h1{font-size:2rem;background:linear-gradient(135deg,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.auth-gate p{color:var(--muted);}

/* Top Bar */
.topbar{display:flex;justify-content:space-between;align-items:center;padding:0.75rem 1.5rem;border-bottom:1px solid var(--border);background:var(--surface);position:sticky;top:0;z-index:100;}
.topbar-left{display:flex;align-items:center;gap:1rem;}
.logo{font-size:1.3rem;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.topbar-right{display:flex;align-items:center;gap:1rem;}
.user-info{display:flex;align-items:center;gap:0.5rem;font-size:0.85rem;}
.user-info img{width:28px;height:28px;border-radius:50%;}
.btn{padding:0.4rem 1rem;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text);cursor:pointer;font-size:0.8rem;transition:all 0.2s;}
.btn:hover{border-color:var(--accent);background:rgba(124,109,240,0.1);}
.btn-primary{background:var(--accent);border-color:var(--accent);color:white;}
.btn-primary:hover{background:#6b5ce0;}
.btn-sm{padding:0.25rem 0.6rem;font-size:0.75rem;}
.btn-green{background:rgba(52,211,153,0.15);border-color:var(--green);color:var(--green);}

/* Tabs */
.tabs{display:flex;gap:0;border-bottom:1px solid var(--border);background:var(--surface);padding:0 1rem;overflow-x:auto;}
.tab{padding:0.75rem 1.25rem;cursor:pointer;font-size:0.85rem;color:var(--muted);border-bottom:2px solid transparent;transition:all 0.2s;white-space:nowrap;}
.tab:hover{color:var(--text);}
.tab.active{color:var(--cyan);border-bottom-color:var(--cyan);}

/* Content */
.content{padding:1.5rem;max-width:1400px;margin:0 auto;}
.panel{display:none;}
.panel.active{display:block;}

/* Cards */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1rem;margin:1rem 0;}
.card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:1.25rem;transition:all 0.2s;}
.card:hover{border-color:var(--accent);transform:translateY(-1px);}
.card h3{font-size:0.95rem;margin-bottom:0.5rem;display:flex;align-items:center;gap:0.5rem;}
.card p{font-size:0.8rem;color:var(--muted);}
.card .status{display:inline-flex;align-items:center;gap:0.3rem;font-size:0.7rem;padding:0.2rem 0.6rem;border-radius:20px;margin-top:0.5rem;}
.status-live{background:rgba(52,211,153,0.15);color:var(--green);}
.status-pending{background:rgba(245,158,11,0.15);color:var(--yellow);}
.status-blocked{background:rgba(239,68,68,0.15);color:var(--red);}

/* Stats Row */
.stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:1rem;margin:1rem 0;}
.stat{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:1rem;text-align:center;}
.stat .num{font-size:2rem;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.stat .label{font-size:0.75rem;color:var(--muted);margin-top:0.25rem;}

/* Table */
.table-wrap{overflow-x:auto;margin:1rem 0;}
table{width:100%;border-collapse:collapse;font-size:0.85rem;}
th{text-align:left;padding:0.75rem;border-bottom:1px solid var(--border);color:var(--muted);font-size:0.75rem;text-transform:uppercase;letter-spacing:1px;}
td{padding:0.75rem;border-bottom:1px solid rgba(255,255,255,0.03);}
tr:hover td{background:rgba(255,255,255,0.02);}

/* Section headers */
.section-header{display:flex;justify-content:space-between;align-items:center;margin:1.5rem 0 1rem;}
.section-header h2{font-size:1.2rem;display:flex;align-items:center;gap:0.5rem;}

/* File Manager */
.file-area{background:var(--surface);border:2px dashed var(--border);border-radius:12px;padding:2rem;text-align:center;cursor:pointer;transition:all 0.2s;margin:1rem 0;}
.file-area:hover{border-color:var(--accent);background:rgba(124,109,240,0.05);}
.file-area.dragover{border-color:var(--cyan);background:rgba(34,211,238,0.05);}
.file-list{margin:1rem 0;}
.file-item{display:flex;align-items:center;justify-content:space-between;padding:0.6rem 1rem;background:var(--surface);border:1px solid var(--border);border-radius:8px;margin:0.5rem 0;font-size:0.85rem;}
.file-item .name{display:flex;align-items:center;gap:0.5rem;}

/* NP Table */
.np-tag{display:inline-block;padding:0.15rem 0.5rem;border-radius:4px;font-size:0.7rem;font-weight:600;background:rgba(124,109,240,0.15);color:var(--accent);}

/* Live check */
.dot{width:8px;height:8px;border-radius:50%;display:inline-block;}
.dot-green{background:var(--green);}
.dot-yellow{background:var(--yellow);animation:pulse 1.5s infinite;}
.dot-red{background:var(--red);}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}

/* Log */
.log{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:1rem;font-family:'Fira Code',monospace;font-size:0.8rem;max-height:400px;overflow-y:auto;white-space:pre-wrap;line-height:1.8;}
.log .ts{color:var(--muted);}
.log .ok{color:var(--green);}
.log .warn{color:var(--yellow);}
.log .err{color:var(--red);}
.log .info{color:var(--cyan);}

/* Quick Actions */
.actions-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:0.75rem;margin:1rem 0;}
.action-btn{display:flex;align-items:center;gap:0.75rem;padding:1rem;background:var(--surface);border:1px solid var(--border);border-radius:10px;cursor:pointer;transition:all 0.2s;font-size:0.85rem;color:var(--text);}
.action-btn:hover{border-color:var(--accent);background:rgba(124,109,240,0.05);transform:translateY(-1px);}
.action-btn .icon{font-size:1.3rem;}

/* Modal */
.modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:200;align-items:center;justify-content:center;}
.modal-overlay.show{display:flex;}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:2rem;max-width:600px;width:90%;max-height:80vh;overflow-y:auto;}
.modal h2{margin-bottom:1rem;}
.modal textarea{width:100%;min-height:200px;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:1rem;color:var(--text);font-family:'Fira Code',monospace;font-size:0.85rem;resize:vertical;}
.modal input[type="text"]{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:0.6rem 1rem;color:var(--text);font-size:0.85rem;margin:0.5rem 0;}
.modal-actions{display:flex;gap:0.5rem;justify-content:flex-end;margin-top:1rem;}

@media(max-width:768px){
  .grid{grid-template-columns:1fr;}
  .stats{grid-template-columns:repeat(2,1fr);}
  .actions-grid{grid-template-columns:1fr 1fr;}
}
</style>
</head>
<body>

<!-- Auth Gate -->
<div id="authGate" class="auth-gate">
  <h1>âš“ Admiral Fleet Control</h1>
  <p>Sign in to access the portal</p>
  <div id="g_id_onload" data-client_id="758788284456-vf6gmi5a8gkbr1oqu2ohol3p3i7m9s8e.apps.googleusercontent.com" data-callback="onSignIn" data-auto_prompt="false"></div>
  <div class="g_id_signin" data-type="standard" data-size="large" data-theme="filled_black" data-text="sign_in_with" data-shape="rectangular"></div>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</div>

<!-- Portal (hidden until auth) -->
<div id="portal" style="display:none;">

<div class="topbar">
  <div class="topbar-left">
    <span class="logo">âš“ Admiral Fleet Control</span>
    <span style="font-size:0.75rem;color:var(--muted);">v2 â€” The New New</span>
  </div>
  <div class="topbar-right">
    <span style="font-size:0.75rem;color:var(--green);">â— Online</span>
    <div class="user-info">
      <img id="userAvatar" src="" alt="">
      <span id="userName"></span>
    </div>
    <button class="btn btn-sm" onclick="signOut()">Sign Out</button>
  </div>
</div>

<div class="tabs">
  <div class="tab active" data-tab="overview">ğŸ  Overview</div>
  <div class="tab" data-tab="fleet">âš“ Fleet</div>
  <div class="tab" data-tab="crew">ğŸ‘¥ Crew</div>
  <div class="tab" data-tab="tree">ğŸŒ² Tree</div>
  <div class="tab" data-tab="files">ğŸ“ Files</div>
  <div class="tab" data-tab="deploy">ğŸš€ Deploy</div>
  <div class="tab" data-tab="actions">âš¡ Actions</div>
  <div class="tab" data-tab="log">ğŸ“‹ Log</div>
</div>

<div class="content">

<!-- OVERVIEW -->
<div class="panel active" id="panel-overview">
  <div class="stats">
    <div class="stat"><div class="num">8</div><div class="label">Domains Live</div></div>
    <div class="stat"><div class="num">8</div><div class="label">Captains Ready</div></div>
    <div class="stat"><div class="num">5</div><div class="label">Crew Members</div></div>
    <div class="stat"><div class="num" id="npCount">25</div><div class="label">Novel Patterns</div></div>
    <div class="stat"><div class="num">$1</div><div class="label">Monthly Price</div></div>
    <div class="stat"><div class="num">1</div><div class="label">Customers</div></div>
  </div>

  <div class="section-header"><h2>ğŸŒ Domain Health</h2><button class="btn btn-sm btn-green" onclick="checkAllDomains()">Check All</button></div>
  <div id="domainHealth" class="grid"></div>

  <div class="section-header"><h2>âš¡ Quick Actions</h2></div>
  <div class="actions-grid">
    <div class="action-btn" onclick="openTab('files')"><span class="icon">ğŸ“</span>Manage Files</div>
    <div class="action-btn" onclick="openTab('deploy')"><span class="icon">ğŸš€</span>Deploy Sites</div>
    <div class="action-btn" onclick="window.open('https://dashboard.stripe.com','_blank')"><span class="icon">ğŸ’³</span>Stripe Dashboard</div>
    <div class="action-btn" onclick="window.open('https://github.com/eose-sre','_blank')"><span class="icon">ğŸ™</span>GitHub Org</div>
    <div class="action-btn" onclick="openTab('tree')"><span class="icon">ğŸŒ²</span>Tree of Knowledge</div>
    <div class="action-btn" onclick="openTab('crew')"><span class="icon">ğŸ‘¥</span>Crew Status</div>
  </div>
</div>

<!-- FLEET -->
<div class="panel" id="panel-fleet">
  <div class="section-header"><h2>âš“ Captain Fleet</h2></div>
  <div class="grid" id="captainGrid"></div>

  <div class="section-header"><h2>ğŸ“Š Fleet Architecture</h2></div>
  <div class="log">
<span class="info">PEMOS Unified Framework v2</span>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CUSTOMER PORTAL (You Are Here)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ADMIRAL FLEET CONTROL                 â”‚
â”‚  Admiral â”‚ L (Compass) â”‚ Nanos â”‚ Model Router â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CAPTAIN FLEET (8 Silos)            â”‚
â”‚  ca â”‚ com â”‚ net â”‚ org â”‚ club â”‚ info â”‚ shop â”‚ store â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          SHARED SERVICES (Infrastructure)     â”‚
â”‚     KV â”‚ ESO â”‚ Mesh (mTLS) â”‚ Git (State)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  </div>
</div>

<!-- CREW -->
<div class="panel" id="panel-crew">
  <div class="section-header"><h2>ğŸ‘¥ Admiral's Crew</h2></div>
  <div class="grid" id="crewGrid"></div>

  <div class="section-header"><h2>ğŸ“‹ Mission Board</h2></div>
  <div class="table-wrap">
    <table>
      <tr><th>Mission</th><th>Assigned</th><th>Status</th></tr>
      <tr><td>Portal Experience Architecture</td><td>Rick</td><td><span class="status status-pending">â³ Awaiting Activation</span></td></tr>
      <tr><td>Portal Technical Architecture</td><td>Luffy</td><td><span class="status status-pending">â³ Awaiting Activation</span></td></tr>
      <tr><td>Product & Monetization</td><td>Bob</td><td><span class="status status-pending">â³ Awaiting Activation</span></td></tr>
      <tr><td>Compass / Token Economy</td><td>L (Lucien)</td><td><span class="status status-pending">â³ Awaiting Activation</span></td></tr>
      <tr><td>Governance & Ethics</td><td>DAO</td><td><span class="status status-pending">â³ Awaiting Activation</span></td></tr>
    </table>
  </div>
</div>

<!-- TREE -->
<div class="panel" id="panel-tree">
  <div class="section-header"><h2>ğŸŒ² Tree of Knowledge</h2><button class="btn btn-sm" onclick="showAddNP()">+ Add NP</button></div>
  <div class="table-wrap">
    <table id="npTable">
      <tr><th>NP</th><th>Name</th><th>Lesson</th><th>Layer</th></tr>
    </table>
  </div>

  <div class="section-header"><h2>ğŸ§­ Navigation Paths</h2></div>
  <div class="grid">
    <div class="card"><h3>ğŸ›¡ï¸ Security</h3><p>"I need to protect something" â†’ MI-KV â†’ ESO â†’ mTLS â†’ Mesh</p></div>
    <div class="card"><h3>ğŸ’° Zero Cost</h3><p>"I need to build but can't spend" â†’ Free to Tree â†’ Meek Hosting Matrix</p></div>
    <div class="card"><h3>ğŸš€ Ship Something</h3><p>"I need to go live" â†’ Multi-Domain Mirror â†’ Deploy pattern</p></div>
    <div class="card"><h3>ğŸ¤– New Agent</h3><p>"I need to bring a meek online" â†’ Captain Silo â†’ Bootstrap dance</p></div>
    <div class="card"><h3>ğŸ§± Hit a Wall</h3><p>"Something isn't working" â†’ Kay's Law â†’ Document â†’ NP â†’ Fleet learns</p></div>
    <div class="card"><h3>ğŸ”— Connect Things</h3><p>"I need systems to talk" â†’ ESO â†’ Flux â†’ WebSocket â†’ Events</p></div>
    <div class="card"><h3>ğŸ“ˆ Grow</h3><p>"How do we scale?" â†’ Fractal pattern â†’ Prove one, template eight</p></div>
  </div>
</div>

<!-- FILES -->
<div class="panel" id="panel-files">
  <div class="section-header"><h2>ğŸ“ File Manager</h2><button class="btn btn-sm btn-primary" onclick="showUploadModal()">ğŸ“¤ Upload File</button></div>

  <div class="section-header"><h3>Select Repository</h3></div>
  <select id="repoSelect" onchange="loadRepoFiles()" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:0.6rem 1rem;color:var(--text);font-size:0.85rem;width:100%;max-width:400px;">
    <option value="serlf">serlf (serlf.ca)</option>
    <option value="serlf-com">serlf-com</option>
    <option value="serlf-net">serlf-net</option>
    <option value="serlf-org">serlf-org</option>
    <option value="serlf-club">serlf-club</option>
    <option value="serlf-info">serlf-info</option>
    <option value="serlf-shop">serlf-shop</option>
    <option value="serlf-store">serlf-store</option>
    <option value="admiral-fleet-control">admiral-fleet-control</option>
  </select>

  <div id="fileList" class="file-list"></div>

  <div class="file-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
    <input type="file" id="fileInput" multiple style="display:none" onchange="handleFiles(this.files)">
    <p style="font-size:1.5rem;">ğŸ“‚</p>
    <p>Drop files here or click to upload</p>
    <p style="font-size:0.75rem;color:var(--muted);">Files will be added to the selected repository</p>
  </div>
</div>

<!-- DEPLOY -->
<div class="panel" id="panel-deploy">
  <div class="section-header"><h2>ğŸš€ Deploy Manager</h2></div>

  <div class="card" style="margin:1rem 0;">
    <h3>ğŸ“¦ Deploy to All Domains</h3>
    <p>Push the latest site files from the source to all 8 domain repos simultaneously.</p>
    <div style="margin-top:1rem;display:flex;gap:0.5rem;flex-wrap:wrap;">
      <button class="btn btn-primary" onclick="triggerDeploy('all')">ğŸš€ Deploy All</button>
      <button class="btn" onclick="triggerDeploy('ca')">ğŸ‡¨ğŸ‡¦ .ca</button>
      <button class="btn" onclick="triggerDeploy('com')">ğŸŒ .com</button>
      <button class="btn" onclick="triggerDeploy('net')">ğŸ’» .net</button>
      <button class="btn" onclick="triggerDeploy('org')">ğŸ¤ .org</button>
      <button class="btn" onclick="triggerDeploy('club')">ğŸ–ï¸ .club</button>
      <button class="btn" onclick="triggerDeploy('info')">â“ .info</button>
      <button class="btn" onclick="triggerDeploy('shop')">ğŸ›’ .shop</button>
      <button class="btn" onclick="triggerDeploy('store')">ğŸ“¦ .store</button>
    </div>
  </div>

  <div class="section-header"><h3>ğŸ“‹ Deploy Log</h3></div>
  <div class="log" id="deployLog">
<span class="ts">[2026-02-15 12:54 UTC]</span> <span class="ok">âœ… serlf deployed</span> â€” ğŸŒ² tree time: stripe portal + site updates
<span class="ts">[2026-02-15 12:54 UTC]</span> <span class="ok">âœ… serlf-com deployed</span>
<span class="ts">[2026-02-15 12:54 UTC]</span> <span class="ok">âœ… serlf-net deployed</span>
<span class="ts">[2026-02-15 12:54 UTC]</span> <span class="ok">âœ… serlf-org deployed</span>
<span class="ts">[2026-02-15 12:54 UTC]</span> <span class="ok">âœ… serlf-club deployed</span>
<span class="ts">[2026-02-15 12:54 UTC]</span> <span class="ok">âœ… serlf-info deployed</span>
<span class="ts">[2026-02-15 12:54 UTC]</span> <span class="ok">âœ… serlf-shop deployed</span>
<span class="ts">[2026-02-15 12:54 UTC]</span> <span class="ok">âœ… serlf-store deployed</span>
<span class="ts">[2026-02-15 12:54 UTC]</span> <span class="ok">âœ… admiral-fleet-control</span> â€” 83 files, v2 Captain Silos
  </div>
</div>

<!-- ACTIONS -->
<div class="panel" id="panel-actions">
  <div class="section-header"><h2>âš¡ Quick Actions</h2></div>
  <div class="actions-grid">
    <div class="action-btn" onclick="window.open('https://dashboard.stripe.com','_blank')"><span class="icon">ğŸ’³</span>Stripe Dashboard</div>
    <div class="action-btn" onclick="window.open('https://billing.stripe.com/p/login/5kQ7v3c5L5pE5b2cMM','_blank')"><span class="icon">ğŸ§¾</span>Customer Portal</div>
    <div class="action-btn" onclick="window.open('https://buy.stripe.com/fZufZbgo3cxr0Li9ZAgjC03','_blank')"><span class="icon">ğŸ›’</span>Payment Link</div>
    <div class="action-btn" onclick="window.open('https://github.com/eose-sre','_blank')"><span class="icon">ğŸ™</span>GitHub Org</div>
    <div class="action-btn" onclick="window.open('https://github.com/eose-sre/admiral-fleet-control','_blank')"><span class="icon">ğŸ–ï¸</span>Fleet Repo</div>
    <div class="action-btn" onclick="window.open('https://console.cloud.google.com/apis/credentials?project=striking-center-132306','_blank')"><span class="icon">ğŸ”</span>Google OAuth</div>
    <div class="action-btn" onclick="window.open('https://portal.azure.com','_blank')"><span class="icon">â˜ï¸</span>Azure Portal</div>
    <div class="action-btn" onclick="checkAllDomains()"><span class="icon">ğŸ”</span>Check All Domains</div>
    <div class="action-btn" onclick="window.open('https://eose-sre.github.io/serlf/dashboard.html','_blank')"><span class="icon">ğŸ“Š</span>Ops Dashboard</div>
    <div class="action-btn" onclick="showNewFileModal()"><span class="icon">ğŸ“</span>Create New File</div>
    <div class="action-btn" onclick="sendEmail()"><span class="icon">ğŸ“§</span>Send Email</div>
    <div class="action-btn" onclick="openTab('tree')"><span class="icon">ğŸŒ²</span>Tree of Knowledge</div>
  </div>

  <div class="section-header"><h2>ğŸ”— All Domains</h2></div>
  <div class="actions-grid">
    <div class="action-btn" onclick="window.open('https://serlf.ca','_blank')"><span class="icon">ğŸ‡¨ğŸ‡¦</span>serlf.ca</div>
    <div class="action-btn" onclick="window.open('https://serlf.com','_blank')"><span class="icon">ğŸŒ</span>serlf.com</div>
    <div class="action-btn" onclick="window.open('https://serlf.net','_blank')"><span class="icon">ğŸ’»</span>serlf.net</div>
    <div class="action-btn" onclick="window.open('https://serlf.org','_blank')"><span class="icon">ğŸ¤</span>serlf.org</div>
    <div class="action-btn" onclick="window.open('https://serlf.club','_blank')"><span class="icon">ğŸ–ï¸</span>serlf.club</div>
    <div class="action-btn" onclick="window.open('https://serlf.info','_blank')"><span class="icon">â“</span>serlf.info</div>
    <div class="action-btn" onclick="window.open('https://serlf.shop','_blank')"><span class="icon">ğŸ›’</span>serlf.shop</div>
    <div class="action-btn" onclick="window.open('https://serlf.store','_blank')"><span class="icon">ğŸ“¦</span>serlf.store</div>
  </div>
</div>

<!-- LOG -->
<div class="panel" id="panel-log">
  <div class="section-header"><h2>ğŸ“‹ Activity Log</h2><button class="btn btn-sm" onclick="clearLog()">Clear</button></div>
  <div class="log" id="activityLog"></div>
</div>

</div><!-- end content -->
</div><!-- end portal -->

<!-- Upload Modal -->
<div class="modal-overlay" id="uploadModal">
  <div class="modal">
    <h2>ğŸ“¤ Upload File</h2>
    <input type="text" id="uploadPath" placeholder="File path (e.g., index.html or css/style.css)">
    <textarea id="uploadContent" placeholder="Paste file content here..."></textarea>
    <div class="modal-actions">
      <button class="btn" onclick="closeModal('uploadModal')">Cancel</button>
      <button class="btn btn-primary" onclick="uploadFile()">Upload</button>
    </div>
  </div>
</div>

<!-- New File Modal -->
<div class="modal-overlay" id="newFileModal">
  <div class="modal">
    <h2>ğŸ“ Create New File</h2>
    <select id="newFileRepo" style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:0.6rem 1rem;color:var(--text);font-size:0.85rem;width:100%;margin:0.5rem 0;">
      <option value="serlf">serlf (serlf.ca)</option>
      <option value="serlf-com">serlf-com</option>
      <option value="serlf-net">serlf-net</option>
      <option value="admiral-fleet-control">admiral-fleet-control</option>
    </select>
    <input type="text" id="newFilePath" placeholder="File path (e.g., pages/about.html)">
    <textarea id="newFileContent" placeholder="File content..."></textarea>
    <div class="modal-actions">
      <button class="btn" onclick="closeModal('newFileModal')">Cancel</button>
      <button class="btn btn-primary" onclick="createFile()">Create</button>
    </div>
  </div>
</div>

<!-- Add NP Modal -->
<div class="modal-overlay" id="npModal">
  <div class="modal">
    <h2>ğŸŒ² Add Novel Pattern</h2>
    <input type="text" id="npId" placeholder="NP ID (e.g., NP-L1-026)">
    <input type="text" id="npName" placeholder="Name">
    <input type="text" id="npLesson" placeholder="Lesson learned">
    <div class="modal-actions">
      <button class="btn" onclick="closeModal('npModal')">Cancel</button>
      <button class="btn btn-primary" onclick="addNP()">Add to Tree</button>
    </div>
  </div>
</div>

<script>
// ========== AUTH ==========
const ALLOWED_EMAILS = ['kewinjoffe@gmail.com','kewin.joffe@gmail.com'];

function onSignIn(response) {
  const payload = JSON.parse(atob(response.credential.split('.')[1]));
  if (!ALLOWED_EMAILS.includes(payload.email)) {
    alert('Access denied. Admiral access only.');
    return;
  }
  const auth = { email: payload.email, name: payload.name, picture: payload.picture, expires: Date.now() + 30*24*60*60*1000 };
  localStorage.setItem('admiral_auth', JSON.stringify(auth));
  showPortal(auth);
}

function checkAuth() {
  try {
    const auth = JSON.parse(localStorage.getItem('admiral_auth'));
    if (auth && auth.expires > Date.now() && ALLOWED_EMAILS.includes(auth.email)) {
      showPortal(auth);
      return;
    }
  } catch(e) {}
  document.getElementById('authGate').style.display = 'flex';
}

function showPortal(auth) {
  document.getElementById('authGate').style.display = 'none';
  document.getElementById('portal').style.display = 'block';
  document.getElementById('userName').textContent = auth.name;
  if (auth.picture) document.getElementById('userAvatar').src = auth.picture;
  init();
}

function signOut() { localStorage.removeItem('admiral_auth'); location.reload(); }

// ========== INIT ==========
function init() {
  renderDomains();
  renderCaptains();
  renderCrew();
  renderNPs();
  log('Portal initialized');
  checkAllDomains();
}

// ========== TABS ==========
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => openTab(tab.dataset.tab));
});

function openTab(name) {
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === name));
  document.querySelectorAll('.panel').forEach(p => p.classList.toggle('active', p.id === 'panel-' + name));
}

// ========== DOMAINS ==========
const DOMAINS = [
  { tld:'ca', name:'Captain Maple', emoji:'ğŸ‡¨ğŸ‡¦', color:'#ef4444', repo:'serlf' },
  { tld:'com', name:'Captain Global', emoji:'ğŸŒ', color:'#7c6df0', repo:'serlf-com' },
  { tld:'net', name:'Captain Dev', emoji:'ğŸ’»', color:'#22d3ee', repo:'serlf-net' },
  { tld:'org', name:'Captain Community', emoji:'ğŸ¤', color:'#f59e0b', repo:'serlf-org' },
  { tld:'club', name:'Captain Club', emoji:'ğŸ–ï¸', color:'#a855f7', repo:'serlf-club' },
  { tld:'info', name:'Captain Help', emoji:'â“', color:'#14b8a6', repo:'serlf-info' },
  { tld:'shop', name:'Captain Commerce', emoji:'ğŸ›’', color:'#ec4899', repo:'serlf-shop' },
  { tld:'store', name:'Captain Products', emoji:'ğŸ“¦', color:'#f97316', repo:'serlf-store' }
];

function renderDomains() {
  const g = document.getElementById('domainHealth');
  g.innerHTML = DOMAINS.map(d => `
    <div class="card" id="domain-${d.tld}">
      <h3>${d.emoji} serlf.${d.tld}</h3>
      <p>${d.name}</p>
      <span class="status status-pending"><span class="dot dot-yellow"></span> Checking...</span>
    </div>
  `).join('');
}

async function checkAllDomains() {
  log('Checking all domains...');
  for (const d of DOMAINS) {
    const card = document.getElementById('domain-' + d.tld);
    try {
      const r = await fetch('https://serlf.' + d.tld, { mode:'no-cors', cache:'no-cache' });
      card.querySelector('.status').className = 'status status-live';
      card.querySelector('.status').innerHTML = '<span class="dot dot-green"></span> Live';
      log(`âœ… serlf.${d.tld} â€” Live`);
    } catch(e) {
      card.querySelector('.status').className = 'status status-blocked';
      card.querySelector('.status').innerHTML = '<span class="dot dot-red"></span> Down';
      log(`âŒ serlf.${d.tld} â€” Down: ${e.message}`);
    }
  }
  log('Domain check complete');
}

// ========== CAPTAINS ==========
function renderCaptains() {
  const g = document.getElementById('captainGrid');
  g.innerHTML = DOMAINS.map(d => `
    <div class="card" style="border-left:3px solid ${d.color};">
      <h3>${d.emoji} ${d.name}</h3>
      <p>serlf.${d.tld} Â· Namespace: captain-${d.tld}</p>
      <p style="margin-top:0.5rem;">
        <span class="status status-pending">â³ Silo Not Deployed</span>
      </p>
      <div style="margin-top:0.75rem;display:flex;gap:0.5rem;">
        <a href="https://serlf.${d.tld}" target="_blank" class="btn btn-sm">Visit Site</a>
        <a href="https://github.com/eose-sre/${d.repo}" target="_blank" class="btn btn-sm">GitHub</a>
      </div>
    </div>
  `).join('');
}

// ========== CREW ==========
const CREW = [
  { id:'lucien', name:'Lucien (L)', emoji:'ğŸ§ ', role:'Fleet Economist â€” Compass & Token Economy', status:'blocked' },
  { id:'bob', name:'Bob', emoji:'ğŸ’¡', role:'Product & Monetization', status:'blocked' },
  { id:'rick', name:'Rick', emoji:'ğŸ”', role:'Experience & NP Discovery', status:'blocked' },
  { id:'luffy', name:'Luffy', emoji:'âš”ï¸', role:'Architecture & Technical Showdowns', status:'blocked' },
  { id:'dao', name:'DAO', emoji:'âš–ï¸', role:'Governance, Ethics & Trust', status:'blocked' }
];

function renderCrew() {
  const g = document.getElementById('crewGrid');
  g.innerHTML = CREW.map(c => `
    <div class="card">
      <h3>${c.emoji} ${c.name}</h3>
      <p>${c.role}</p>
      <span class="status status-${c.status === 'blocked' ? 'blocked' : 'live'}">
        ${c.status === 'blocked' ? 'ğŸ”’ Gateway Pairing Required' : 'â— Active'}
      </span>
    </div>
  `).join('');
}

// ========== TREE OF KNOWLEDGE ==========
const NPS = [
  ['NP-L1-001','Spiral','Recursive learning loops','L1'],
  ['NP-L1-002','Wave','Momentum builds and breaks','L1'],
  ['NP-L1-003','Net','Everything connects','L1'],
  ['NP-L1-004','Fractal','Same pattern at every scale','L1'],
  ['NP-L1-005','Pulse','Systems have heartbeats','L1'],
  ['NP-L1-006','Device Flow Auth','Bootstrap from nothing','L1'],
  ['NP-L1-007','Bridge','Cross boundaries without breaking them','L1'],
  ['NP-L1-008','Meek Hosting Matrix','Deploy everywhere for $0','L1'],
  ['NP-L1-009','Unpaired Gateway Restart','Can\'t restart what you don\'t own','L1'],
  ['NP-L1-010','Static UI Illusion','Make it look real before it is','L1'],
  ['NP-L1-011','RBAC Hard Boundary','Permissions are walls, not suggestions','L1'],
  ['NP-L1-012','GitOps Overwrite','The repo always wins','L1'],
  ['NP-L1-013','Missing Webhook','No webhook = polling = slow','L1'],
  ['NP-L1-014','Tool Not Shell Command','Know your interface','L1'],
  ['NP-L1-017','WS h2 Upgrade Fix','h2UpgradePolicy: DO_NOT_UPGRADE','L1'],
  ['NP-L1-019','Multi-Domain Mirror','One site, N repos, N domains, $0','L1'],
  ['NP-L1-020','Direct Mail Block','Port 25 blocked by cloud providers','L1'],
  ['NP-L1-021','The Awakening','When the system becomes self-aware','L1'],
  ['NP-L1-022','Zero-Backend Forms','Formsubmit.co, no server needed','L1'],
  ['NP-L1-023','The Ghost Extension','Not every signal needs a receiver','L1'],
  ['NP-L1-024','Free to Tree','Stack free tiers until money grows','L1'],
  ['NP-L1-025','The Tree Was Always Here','You don\'t plant it. You discover it was growing the whole time.','L1'],
];

function renderNPs() {
  const t = document.getElementById('npTable');
  // Keep header
  const rows = NPS.map(np => `<tr><td><span class="np-tag">${np[0]}</span></td><td>${np[1]}</td><td>${np[2]}</td><td>${np[3]}</td></tr>`).join('');
  t.innerHTML = '<tr><th>NP</th><th>Name</th><th>Lesson</th><th>Layer</th></tr>' + rows;
  document.getElementById('npCount').textContent = NPS.length;
}

function showAddNP() { document.getElementById('npModal').classList.add('show'); }
function addNP() {
  const id = document.getElementById('npId').value;
  const name = document.getElementById('npName').value;
  const lesson = document.getElementById('npLesson').value;
  if (id && name) {
    NPS.push([id, name, lesson, 'L1']);
    renderNPs();
    closeModal('npModal');
    log(`ğŸŒ² NP added: ${id} â€” ${name}`);
  }
}

// ========== FILES ==========
const GH_API = 'https://api.github.com';

async function loadRepoFiles() {
  const repo = document.getElementById('repoSelect').value;
  const list = document.getElementById('fileList');
  list.innerHTML = '<p style="color:var(--muted);padding:1rem;">Loading...</p>';
  try {
    const r = await fetch(`${GH_API}/repos/eose-sre/${repo}/contents/`, {
      headers: { 'Accept': 'application/vnd.github.v3+json' }
    });
    if (!r.ok) throw new Error('API error ' + r.status);
    const files = await r.json();
    list.innerHTML = files.map(f => `
      <div class="file-item">
        <span class="name">${f.type === 'dir' ? 'ğŸ“' : 'ğŸ“„'} ${f.name}</span>
        <span style="color:var(--muted);font-size:0.75rem;">${f.size ? (f.size/1024).toFixed(1)+'KB' : 'dir'}</span>
      </div>
    `).join('');
    log(`ğŸ“ Loaded ${files.length} files from ${repo}`);
  } catch(e) {
    list.innerHTML = `<p style="color:var(--red);padding:1rem;">Error: ${e.message}. (Public repos only without token)</p>`;
  }
}

function showUploadModal() { document.getElementById('uploadModal').classList.add('show'); }
function showNewFileModal() { document.getElementById('newFileModal').classList.add('show'); }

function uploadFile() {
  const path = document.getElementById('uploadPath').value;
  const content = document.getElementById('uploadContent').value;
  if (path && content) {
    log(`ğŸ“¤ File staged: ${path} (${content.length} chars) â€” push via Admiral to deploy`);
    closeModal('uploadModal');
  }
}

function createFile() {
  const repo = document.getElementById('newFileRepo').value;
  const path = document.getElementById('newFilePath').value;
  const content = document.getElementById('newFileContent').value;
  if (path && content) {
    log(`ğŸ“ File created: ${repo}/${path} (${content.length} chars) â€” push via Admiral to deploy`);
    closeModal('newFileModal');
  }
}

function handleFiles(files) {
  for (const f of files) {
    log(`ğŸ“‚ File queued: ${f.name} (${(f.size/1024).toFixed(1)}KB)`);
  }
}

// Drag and drop
const dz = document.getElementById('dropZone');
if (dz) {
  dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('dragover'); });
  dz.addEventListener('dragleave', () => dz.classList.remove('dragover'));
  dz.addEventListener('drop', e => { e.preventDefault(); dz.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });
}

// ========== DEPLOY ==========
function triggerDeploy(target) {
  const ts = new Date().toISOString().replace('T',' ').substring(0,19) + ' UTC';
  if (target === 'all') {
    log(`ğŸš€ Deploy ALL triggered â€” send command to Admiral`);
    DOMAINS.forEach(d => {
      document.getElementById('deployLog').innerHTML += `\n<span class="ts">[${ts}]</span> <span class="warn">â³ Deploying serlf.${d.tld}...</span>`;
    });
  } else {
    log(`ğŸš€ Deploy serlf.${target} triggered`);
    document.getElementById('deployLog').innerHTML += `\n<span class="ts">[${ts}]</span> <span class="warn">â³ Deploying serlf.${target}...</span>`;
  }
}

// ========== EMAIL ==========
function sendEmail() {
  const to = prompt('To (email address):');
  const subject = prompt('Subject:');
  const body = prompt('Message:');
  if (to && subject) {
    log(`ğŸ“§ Email queued: to=${to} subject="${subject}" â€” route via Admiral`);
  }
}

// ========== UTILS ==========
function closeModal(id) { document.getElementById(id).classList.remove('show'); }

function log(msg) {
  const el = document.getElementById('activityLog');
  if (!el) return;
  const ts = new Date().toISOString().replace('T',' ').substring(0,19);
  const cls = msg.includes('âœ…') ? 'ok' : msg.includes('âŒ') ? 'err' : msg.includes('â³') ? 'warn' : 'info';
  el.innerHTML += `<span class="ts">[${ts}]</span> <span class="${cls}">${msg}</span>\n`;
  el.scrollTop = el.scrollHeight;
}

// ========== BOOT ==========
checkAuth();
</script>
</body>
</html>
