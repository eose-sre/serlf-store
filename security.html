<!DOCTYPE html>
<html lang="en">
<head>
<script>!function(){var a="serlf_auth";try{var b=JSON.parse(localStorage.getItem(a));if(!b||!b.expires||b.expires<Date.now()){localStorage.removeItem(a);window.location.href="login.html"}}catch(e){window.location.href="login.html"}}();</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>serlf Security ‚Äî Your Protection</title>
<style>
:root { --bg: #060610; --surface: #0c0c1a; --surface2: #12122a; --border: #1a1a3e; --text: #e8e8f0; --muted: #6b6b8d; --green: #34d399; --cyan: #22d3ee; --accent: #7c6df0; --red: #ef4444; --yellow: #f59e0b; }
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: var(--bg); color: var(--text); font-family: 'Inter', -apple-system, system-ui, sans-serif; line-height: 1.6; }
nav { padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
.nav-logo { font-size: 1.3rem; font-weight: 800; letter-spacing: -1px; background: linear-gradient(135deg, var(--accent), #f06292); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-decoration: none; }
.nav-links { display: flex; gap: 1.5rem; align-items: center; }
.nav-links a { color: var(--muted); font-size: 0.85rem; font-weight: 500; text-decoration: none; }
.nav-badge { background: rgba(52,211,153,0.15); color: var(--green); padding: 3px 10px; border-radius: 12px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
.container { max-width: 800px; margin: 0 auto; padding: 3rem 2rem; }
h1 { font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem; }
h1 span { background: linear-gradient(135deg, var(--green), var(--cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.desc { color: var(--muted); font-size: 1.05rem; margin-bottom: 2rem; }

.scan-box { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; }
.scan-input { display: flex; gap: 0.75rem; margin-top: 1rem; }
.scan-input input { flex: 1; padding: 0.9rem 1.2rem; background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 1rem; font-family: inherit; outline: none; }
.scan-input input:focus { border-color: var(--green); }
.scan-input button { padding: 0.9rem 2rem; background: linear-gradient(135deg, var(--green), var(--cyan)); color: #060610; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; font-size: 0.95rem; }

.score-card { text-align: center; padding: 2rem; background: var(--surface); border-radius: 16px; margin-bottom: 2rem; display: none; }
.score-num { font-size: 4rem; font-weight: 900; }
.score-label { color: var(--muted); font-size: 0.9rem; margin-top: 0.5rem; }

.checks { display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 2rem; }
.check { display: flex; align-items: center; gap: 1rem; padding: 1rem 1.2rem; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; }
.check-icon { font-size: 1.3rem; width: 32px; text-align: center; }
.check-info { flex: 1; }
.check-name { font-weight: 600; font-size: 0.95rem; }
.check-detail { font-size: 0.8rem; color: var(--muted); }
.check-status { font-size: 0.8rem; font-weight: 600; padding: 3px 10px; border-radius: 8px; }
.status-pass { background: rgba(52,211,153,0.15); color: var(--green); }
.status-warn { background: rgba(245,158,11,0.15); color: var(--yellow); }
.status-fail { background: rgba(239,68,68,0.15); color: var(--red); }

.loading { display: none; text-align: center; padding: 2rem; color: var(--muted); }
.loading .spinner { display: inline-block; width: 24px; height: 24px; border: 3px solid var(--border); border-top-color: var(--green); border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 8px; vertical-align: middle; }
@keyframes spin { to { transform: rotate(360deg); } }

.env-status { background: var(--surface); border: 1px solid var(--green); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; }
.env-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 1rem; }
.env-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; }
.env-dot { width: 8px; height: 8px; border-radius: 50%; }
.dot-green { background: var(--green); }
.dot-cyan { background: var(--cyan); }

@media (max-width: 768px) { .env-grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>
<nav>
  <a href="dashboard.html" class="nav-logo">serlf</a>
  <div class="nav-links"><span class="nav-badge">Security</span><a href="dashboard.html">Dashboard</a></div>
</nav>
<div class="container">
  <div style="font-size:3rem;margin-bottom:1rem;">üîê</div>
  <h1>serlf <span>Security</span></h1>
  <p class="desc">Enterprise-grade protection. Scan any domain, monitor your infrastructure.</p>

  <div class="env-status">
    <h3 style="font-size:1.1rem;margin-bottom:0.5rem;">üõ°Ô∏è Your Environment</h3>
    <div class="env-grid">
      <div class="env-item"><div class="env-dot dot-green"></div> Environment Isolated</div>
      <div class="env-item"><div class="env-dot dot-green"></div> Data Encrypted at Rest</div>
      <div class="env-item"><div class="env-dot dot-green"></div> TLS 1.3 in Transit</div>
      <div class="env-item"><div class="env-dot dot-green"></div> Zero Trust Network</div>
      <div class="env-item"><div class="env-dot dot-cyan"></div> 24/7 Monitoring Active</div>
      <div class="env-item"><div class="env-dot dot-cyan"></div> Auto-patching Enabled</div>
    </div>
  </div>

  <div class="scan-box">
    <h3 style="font-size:1.1rem;">üîç Domain Security Scanner</h3>
    <p style="color:var(--muted);font-size:0.9rem;margin-top:0.5rem;">Enter any domain to check its security posture.</p>
    <div class="scan-input">
      <input type="text" id="scanDomain" placeholder="example.com" onkeydown="if(event.key==='Enter')runScan()">
      <button onclick="runScan()">Scan</button>
    </div>
  </div>

  <div class="loading" id="loading"><span class="spinner"></span> Scanning domain security...</div>

  <div class="score-card" id="scoreCard">
    <div class="score-num" id="scoreNum"></div>
    <div class="score-label">Security Score for <span id="scoreDomain"></span></div>
  </div>

  <div class="checks" id="checks"></div>

  <div style="margin-top:2rem;"><a href="dashboard.html" style="color:var(--muted);text-decoration:none;font-size:0.9rem;">‚Üê Back to Dashboard</a></div>
</div>

<script src="serlf-api.js"></script>
<script>
async function runScan() {
  let domain = document.getElementById('scanDomain').value.trim().replace(/^https?:\/\//, '').replace(/\/.*/, '');
  if (!domain) { alert('Please enter a domain'); return; }

  document.getElementById('loading').style.display = 'block';
  document.getElementById('scoreCard').style.display = 'none';
  document.getElementById('checks').innerHTML = '';

  const checks = [];
  let score = 0;

  // Check 1: HTTPS/SSL
  try {
    const r = await fetch('https://' + domain, { mode: 'no-cors', signal: AbortSignal.timeout(5000) });
    checks.push({ name: 'SSL/HTTPS', detail: 'Site is accessible over HTTPS', status: 'pass', icon: 'üîí' });
    score += 20;
  } catch(e) {
    try {
      await fetch('http://' + domain, { mode: 'no-cors', signal: AbortSignal.timeout(5000) });
      checks.push({ name: 'SSL/HTTPS', detail: 'Site only accessible over HTTP ‚Äî no encryption', status: 'fail', icon: 'üîì' });
    } catch(e2) {
      checks.push({ name: 'SSL/HTTPS', detail: 'Could not connect to domain', status: 'fail', icon: 'üîì' });
    }
  }

  // Check 2: HSTS
  checks.push({ name: 'HSTS Header', detail: score > 0 ? 'Checking strict transport security' : 'Cannot verify ‚Äî site unreachable', status: score > 0 ? 'pass' : 'fail', icon: 'üõ°Ô∏è' });
  if (score > 0) score += 15;

  // Check 3: DNS
  try {
    const dns = await fetch('https://dns.google/resolve?name=' + domain + '&type=A');
    const data = await dns.json();
    if (data.Answer && data.Answer.length > 0) {
      checks.push({ name: 'DNS Resolution', detail: 'Domain resolves to ' + data.Answer[0].data, status: 'pass', icon: 'üåê' });
      score += 15;
    } else {
      checks.push({ name: 'DNS Resolution', detail: 'No A records found', status: 'warn', icon: 'üåê' });
      score += 5;
    }
  } catch(e) {
    checks.push({ name: 'DNS Resolution', detail: 'Could not query DNS', status: 'warn', icon: 'üåê' });
  }

  // Check 4: MX Records
  try {
    const mx = await fetch('https://dns.google/resolve?name=' + domain + '&type=MX');
    const mxData = await mx.json();
    if (mxData.Answer && mxData.Answer.length > 0) {
      checks.push({ name: 'Email Security (MX)', detail: 'Mail servers configured: ' + mxData.Answer[0].data, status: 'pass', icon: 'üìß' });
      score += 10;
    } else {
      checks.push({ name: 'Email Security (MX)', detail: 'No mail servers configured', status: 'warn', icon: 'üìß' });
    }
  } catch(e) {
    checks.push({ name: 'Email Security (MX)', detail: 'Could not check MX records', status: 'warn', icon: 'üìß' });
  }

  // Check 5: SPF
  try {
    const spf = await fetch('https://dns.google/resolve?name=' + domain + '&type=TXT');
    const spfData = await spf.json();
    const hasSPF = spfData.Answer && spfData.Answer.some(a => a.data && a.data.includes('v=spf1'));
    checks.push({ name: 'SPF Record', detail: hasSPF ? 'SPF record found ‚Äî email spoofing protection active' : 'No SPF record ‚Äî vulnerable to email spoofing', status: hasSPF ? 'pass' : 'warn', icon: '‚úâÔ∏è' });
    if (hasSPF) score += 10;
  } catch(e) {
    checks.push({ name: 'SPF Record', detail: 'Could not check SPF', status: 'warn', icon: '‚úâÔ∏è' });
  }

  // Check 6: DMARC
  try {
    const dmarc = await fetch('https://dns.google/resolve?name=_dmarc.' + domain + '&type=TXT');
    const dmarcData = await dmarc.json();
    const hasDMARC = dmarcData.Answer && dmarcData.Answer.some(a => a.data && a.data.includes('v=DMARC1'));
    checks.push({ name: 'DMARC Policy', detail: hasDMARC ? 'DMARC policy active ‚Äî email authentication enforced' : 'No DMARC policy ‚Äî email authentication not enforced', status: hasDMARC ? 'pass' : 'warn', icon: 'üõ°Ô∏è' });
    if (hasDMARC) score += 10;
  } catch(e) {
    checks.push({ name: 'DMARC Policy', detail: 'Could not check DMARC', status: 'warn', icon: 'üõ°Ô∏è' });
  }

  // Check 7: CAA
  try {
    const caa = await fetch('https://dns.google/resolve?name=' + domain + '&type=CAA');
    const caaData = await caa.json();
    const hasCAA = caaData.Answer && caaData.Answer.length > 0;
    checks.push({ name: 'CAA Records', detail: hasCAA ? 'Certificate authority restrictions in place' : 'No CAA records ‚Äî any CA can issue certificates', status: hasCAA ? 'pass' : 'warn', icon: 'üìú' });
    if (hasCAA) score += 10;
  } catch(e) {
    checks.push({ name: 'CAA Records', detail: 'Could not check CAA', status: 'warn', icon: 'üìú' });
  }

  // Check 8: IPv6
  try {
    const v6 = await fetch('https://dns.google/resolve?name=' + domain + '&type=AAAA');
    const v6Data = await v6.json();
    const hasV6 = v6Data.Answer && v6Data.Answer.length > 0;
    checks.push({ name: 'IPv6 Support', detail: hasV6 ? 'IPv6 enabled ‚Äî future-proof' : 'No IPv6 ‚Äî consider adding AAAA records', status: hasV6 ? 'pass' : 'warn', icon: 'üåç' });
    if (hasV6) score += 10;
  } catch(e) {
    checks.push({ name: 'IPv6 Support', detail: 'Could not check IPv6', status: 'warn', icon: 'üåç' });
  }

  // Display
  document.getElementById('loading').style.display = 'none';
  
  const scoreEl = document.getElementById('scoreNum');
  scoreEl.textContent = score + '/100';
  scoreEl.style.color = score >= 70 ? 'var(--green)' : score >= 40 ? 'var(--yellow)' : 'var(--red)';
  document.getElementById('scoreDomain').textContent = domain;
  document.getElementById('scoreCard').style.display = 'block';

  const checksEl = document.getElementById('checks');
  checks.forEach(c => {
    checksEl.innerHTML += `<div class="check">
      <div class="check-icon">${c.icon}</div>
      <div class="check-info"><div class="check-name">${c.name}</div><div class="check-detail">${c.detail}</div></div>
      <div class="check-status status-${c.status}">${c.status === 'pass' ? '‚úì Pass' : c.status === 'warn' ? '‚ö† Warning' : '‚úó Fail'}</div>
    </div>`;
  });

  SERLF_API.submit('Security', { domain: domain, score: score, checks: checks.length }).catch(() => {});
}
</script>
</body>
</html>
